## cookie 解决的需求

网页的信息传输主要依靠 `http` 协议，而 `http` 协议是**无状态**的

所谓的无状态，指的是，数据请求和接收完毕后就会断开连接，因此，每次请求之间是**独立**的。

比如在一个账号登录的场景中，用户输入了账号和密码并发送了请求，服务器验证后，如果成功则返回网页数据。

但用户后续的操作，如果需要再次发送请求，那么该次请求无法确定用户的身份，因为该次请求和上次登录请求完全独立。

因此需要一个手段，在请求中携带一些额外的信息，用来辅助服务器确认用户的状态。

**cookie就是一种解决方案**

还是这个用户登录的场景，如果服务器成功验证了账号和密码，那么可以在响应数据的相应头中，添加 `set-cookie` 键值对，浏览器解析到该响应头就会自动设置一个 `cookie` 在浏览器中

从而在后续的请求中，该 `cookie` 可以作为用户的信息携带在请求头中

## cookie 的组成

> `?` 表示可选，一般都会有默认值, 
>
> `:` 表示默认值

- **key : [value]**
- **domain** ?  `域 : 当前的demain`

- **path** ?  `: 当前的path`
- **secure** ? `: false`

- **expire**?  `: 当前会话`
- **httponly?** 该键值对表示，只允许传输中使用，不允许通过js操作



## cookie 的发送

当浏览器向服务器发送请求时，会检查cookie，如果一个cookie**同时满足**以下条件，则该 cookie 会被**附带到请求头**中

- expire 没有过期
- cookie 的 `domain(域)` 是否满足条件

>  解释一下符合条件的 domain： 
>
> 如果 cookie 的 `domain` 的值是 `.baidu.com` , 那么满足条件的域是`xxx.baidu.com` (xxx表示任意子站，可以是任意字符，比如 `www.baidu.com` 或者 `news.baidu.com`)， 如果 `domain` 的值是 `www.baidu.com` 那么符合条件的域是 `www.baidu.com`或者`xxx.www.baidu.com`

- `path` 是否匹配

> 例如：cookie的`path` 的值为 `/news` ,那么就可以访问诸如 `/news`,或者 `/news/demo`,`/news/a/b/c` 等，但不能匹配 `/videos`
>
> 因此，按照这种规则，如果 `path` 的值为 `/` ，则可以匹配所有路径

- `secure` 是否匹配

> 如果 `secure` 的值是 `true` 则要求请求协议必须是 `https`
>
> 如果是`false`, 则`http` 和`https` 均可



**注意：**

需要说明的是，cookie并不会检查端口，但对域和path有要求

当上列匹配全部成功，则浏览器会在本次请求的请求头中，添加一个

```xml
Cookie: [key1]=[value1];[key2]=[value2]
```

的键值对，其中 `[key]`和`[value]`表示满足条件的cookie的 key 和 value的值



## cookie 的设置

- 服务器响应：当响应头重携带设置cookie的信息时，浏览器会自动设置cookie
- 客户端自行设置：可以在客户端自行添加cookie,只不过用户几乎很少用，但也有应用场景，比如用户选择了 `不要再弹出广告`，就可以通过js把这种信息保存到cookie中，下次服务器就不会再响应广告过来了

 